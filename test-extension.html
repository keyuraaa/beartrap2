<!DOCTYPE html>
<html>
<head>
    <title>Extension API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #071027; color: #cfeff3; }
        .result { margin: 10px 0; padding: 10px; background: #0a1a3a; border-radius: 4px; }
        .success { border-left: 4px solid #00f6d8; }
        .error { border-left: 4px solid #ff4444; }
        button { background: #00f6d8; color: #071027; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; margin: 5px; }
        button:hover { background: #00d4ba; }
    </style>
</head>
<body>
    <h1>Extension API Connection Test</h1>
    <p>This page tests if the API endpoints are accessible (simulating what the extension does).</p>
    
    <button onclick="testStats()">Test /api/stats</button>
    <button onclick="testTopIps()">Test /api/top-ips</button>
    <button onclick="testGeo()">Test /api/geo</button>
    <button onclick="testAll()">Test All</button>
    
    <div id="results"></div>

    <script>
        const API = 'http://localhost:4000';
        const resultsDiv = document.getElementById('results');

        function addResult(message, isSuccess) {
            const div = document.createElement('div');
            div.className = 'result ' + (isSuccess ? 'success' : 'error');
            div.textContent = message;
            resultsDiv.insertBefore(div, resultsDiv.firstChild);
        }

        async function testStats() {
            try {
                const response = await fetch(API + '/api/stats');
                const data = await response.json();
                addResult('✓ /api/stats: Success - Active: ' + data.active + ', Total Attacks: ' + data.total_attacks, true);
            } catch (error) {
                addResult('✗ /api/stats: Failed - ' + error.message, false);
            }
        }

        async function testTopIps() {
            try {
                const response = await fetch(API + '/api/top-ips');
                const data = await response.json();
                addResult('✓ /api/top-ips: Success - Found ' + data.length + ' IPs', true);
            } catch (error) {
                addResult('✗ /api/top-ips: Failed - ' + error.message, false);
            }
        }

        async function testGeo() {
            try {
                const response = await fetch(API + '/api/geo?ip=8.8.8.8');
                const data = await response.json();
                addResult('✓ /api/geo: Success - ' + (data.error ? 'Geo service unavailable' : 'Location: ' + (data.city || 'Unknown')), true);
            } catch (error) {
                addResult('✗ /api/geo: Failed - ' + error.message, false);
            }
        }

        async function testAll() {
            resultsDiv.innerHTML = '<div class="result">Running all tests...</div>';
            await testStats();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testTopIps();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testGeo();
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            setTimeout(testAll, 500);
        });
    </script>
</body>
</html>
